from typing import Sequence
from time import sleep

from loguru import logger
from telebot import TeleBot
from telebot.apihelper import ApiTelegramException


# –ó–Ω–∞—á–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
BOT_TOKEN: str = "7760802869:AAHoN-ZnoqE_uXj9m1nqE1vgZ3h6nXj07IQ"
MESSAGE_TEXT: str = """
–í–∞–∂–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ! –£ –Ω–∞—Å –Ω–æ–≤—ã–π –£–º–Ω—ã–π –ë–æ—Ç. 

–ü—Ä–∏–≤–µ—Ç!
–ú—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —É–ª—É—á—à–µ–Ω–∏–µ–º —Å–µ—Ä–≤–∏—Å–∞ –∏ –ø–æ—ç—Ç–æ–º—É –ø–µ—Ä–µ–µ—Ö–∞–ª–∏ –≤ –Ω–æ–≤–æ–≥–æ, –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –∏ —É–º–Ω–æ–≥–æ –±–æ—Ç–∞! üß†

–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç –¥–ª—è —Ç–µ–±—è?
–°—Ç–∞—Ä—ã–π –±–æ—Ç —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–≥–æ –¥–Ω—è –ø–µ—Ä–µ—Å—Ç–∞–ª –æ—Ç–≤–µ—á–∞—Ç—å.
–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –Ω–æ–≤–æ–º –±–æ—Ç–µ.
*–¢–∞–º –≤—Å—ë —Å—Ç–∞–ª–æ –µ—â–µ –±—ã—Å—Ç—Ä–µ–µ, —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ —Ñ–∏—à–∫–∏.

–ù–µ —Ç–µ—Ä—è–π —Å–≤—è–∑—å —Å –Ω–∞–º–∏ ‚Äî –∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ –Ω–æ–≤–æ–º—É –±–æ—Ç—É!

[üëâ –ù–ê–ñ–ú–ò, –ß–¢–û–ë–´ –ü–ï–†–ï–ô–¢–ò –ö –ù–û–í–û–ú–£ –ë–û–¢–£](https://t.me/umnoe_serdce_bot)

–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã —Å –Ω–∞–º–∏!"""

USER_IDS: Sequence[int] = [
89459880,
335242099,
301329175,
675517901,
5941480153,
767694023,
857912969,
704660070,
798336395,
105022614,
1263186995,
5208643833,
45452719,
689142697,
7933501901,
730128451,
626281400,
6572127034,
282191514,
268500137,
300466757,
6545016282,
300287274,
816403169,
267090294,
882130717,
75859788,
97141878,
676636361,
982808108,
793126080,
6247503780,
1062785464,
920243691,
7054934059,
16600079,
370592135,
882238165,
387563422,
128796796,
242859680,
389664027,
19097258,
382673821,
415495474,
1433065779,
347363943,
932965955,
383122495,
1509200683,
119578495,
635005575,
396310162,
897930265,
473598273,
892476544,
224606278,
233886385,
131807815,
391768830,
1681700128,
176127773,
418520242,
474386832,
1370599403,
275182986,
372261747,
287245905,
340467105,
513297098,
351305701,
115554929,
7662979197,
126629297,
184740,
2084000669,
1198374420,
456881481,
431088001,
348042165,
429165028,
6686252436,
8106798383,
253832599,
342708115,
2010655317,
49868,
116365788,
462682757,
652798541,
965349480,
149519428,
1432067355,
232464762,
78636971,
471862577,
1037265169,
303195179,
6132066143,
1735058152,
378829136,
989604210,
595679281,
661410638,
6559517909,
412781592,
980489652,
586842072,
199239267,
265368011,
313840453,
320729903,
862002483,
244230773,
1193809507,
846819641,
443198342,
5981228193,
183284948,
508598783,
453016681,
505895787,
283491222,
73704772,
307647419,
112344167,
6667712931,
650951225,
443637188,
1928127081,
74099221,
266201106,
528157155,
765853857,
244673801,
98147427,
6020118600,
311136245,
6596956331,
1388346235,
202400174,
688737391,
700343258,
57888697,
294157402,
1318974287,
11251,
835211076,
609145494,
1030463058,
217181035,
7936875555,
124046844,
91519913,
429682105,
1626657234,
363282742,
1043995693,
1943128566,
924460979,
191490570,
358106146,
368871560,
112758382,
355743712,
1454634519,
6653339547,
6458582906,
958316828,
492787978,
1343418894,
7808709445,
875375598,
586945814,
551185231,
768476259,
288167235,
254414132,
405625465,
1239964135,
406509642,
176466029,
296620317,
695049651,
6848838148,
313065423,
717453075,
1474066576,
1153165248,
458086296,
934952498,
443148875,
633553,
263078462,
859171045,
189579570,
520379429,
119242,
792218576,
683344211,
1221260931,
362658103,
6466518322,
346532278,
279205500,
835832111,
1435553031,
804293111,
339672298,
237956219,
341089850,
442900568,
215029137,
423831704,
234510703,
173529907,
92875755,
1260150635,
591461349,
1315625057,
200553162,
999406980,
6899808815,
2122343700,
125370777,
302898534,
224128452,
134208952,
497003410,
428994912,
1090831918,
786286816,
2125692227,
283708532,
322226638,
364752975,
639081283,
262945335,
210470676,
358458366,
924966721,
1288657834,
348028748,
722628715,
389901222,
903661657,
401235817,
92373893,
567522380,
806363933,
503500071,
160077561,
408401202,
254077066,
347900509,
992791745,
179831457,
907870508,
374164473,
230589494,
561060337,
490984964,
1172360862,
470540378,
706030316,
1518407514,
117005422,
752735411,
914839821,
5030184704,
721571144,
147189327,
7501544245,
1144396711,
477807142,
7761152635,
328456472,
7483651426,
517447157,
187192911,
741594491,
175419589,
566346194,
6197336281,
511638020,
7272702936,
807219373,
1899407331,
723377363,
305965549,
382052667,
353100359,
257147489,
544598642,
268366950,
467284095,
232194189,
400472106,
5759928698,
298854567,
253631309,
222047692,
830510092,
1347014670,
920236972,
5726772923,
1024067673,
723332263,
962701454,
211527912,
659621573,
475094172,
235625879,
5776311883,
454714838,
196660504,
1450120760,
975081522,
897869808,
177202174,
232626204,
780864407,
314188367,
2099857321,
1087968824,
320122218,
]


def send_bulk_messages(bot_token: str, text: str, user_ids: Sequence[int]) -> None:
    if not bot_token:
        raise ValueError("BOT_TOKEN –ø—É—Å—Ç")
    if not text:
        raise ValueError("MESSAGE_TEXT –ø—É—Å—Ç")
    if not user_ids:
        logger.warning("–°–ø–∏—Å–æ–∫ USER_IDS –ø—É—Å—Ç ‚Äî —Ä–∞—Å—Å—ã–ª–∞—Ç—å –Ω–µ–∫–æ–º—É")
        return

    bot = TeleBot(bot_token, parse_mode=None)

    total = len(user_ids)
    sent_count = 0
    blocked_count = 0
    error_count = 0

    logger.info(f"–ù–∞—á–∞–ª–æ —Ä–∞—Å—Å—ã–ª–∫–∏: –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π={total}")

    for index, user_id in enumerate(user_ids, start=1):
        try:
            bot.send_message(chat_id=user_id, text=text, parse_mode='Markdown')
            sent_count += 1
            logger.debug(f"–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ {index}/{total} ‚Üí {user_id}")
        except ApiTelegramException as exc:
            if exc.error_code == 403:
                blocked_count += 1
                logger.warning(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –±–æ—Ç–∞ (403)")
            else:
                error_count += 1
                logger.error(f"–û—à–∏–±–∫–∞ API –¥–ª—è {user_id}: {exc}")
        except Exception as exc:  # noqa: BLE001
            error_count += 1
            logger.error(f"–ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è {user_id}: {exc}")

        # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞, —á—Ç–æ–±—ã –Ω–µ —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã Telegram
        sleep(0.05)

    logger.info(
        "–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | –≤—Å–µ–≥–æ={total} | –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ={sent} | –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏={blocked} | –æ—à–∏–±–∫–∏={errors}".format(
            total=total, sent=sent_count, blocked=blocked_count, errors=error_count
        )
    )


if __name__ == "__main__":
    send_bulk_messages(BOT_TOKEN, MESSAGE_TEXT, USER_IDS)


